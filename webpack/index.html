<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | Range&#39;s Documents.</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Meet more than the eyes.">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.76b04930.js" as="script"><link rel="preload" href="/assets/js/2.f4607b1e.js" as="script"><link rel="preload" href="/assets/js/22.dddc26a9.js" as="script"><link rel="prefetch" href="/assets/js/10.f1a63439.js"><link rel="prefetch" href="/assets/js/11.ee698251.js"><link rel="prefetch" href="/assets/js/12.cb6c9e06.js"><link rel="prefetch" href="/assets/js/13.70cff9bc.js"><link rel="prefetch" href="/assets/js/14.4a79e630.js"><link rel="prefetch" href="/assets/js/15.67d11263.js"><link rel="prefetch" href="/assets/js/16.72f4a548.js"><link rel="prefetch" href="/assets/js/17.0268da32.js"><link rel="prefetch" href="/assets/js/18.cb942bd1.js"><link rel="prefetch" href="/assets/js/19.1c1462cc.js"><link rel="prefetch" href="/assets/js/20.633a6928.js"><link rel="prefetch" href="/assets/js/21.0ed654e1.js"><link rel="prefetch" href="/assets/js/3.aa48cf35.js"><link rel="prefetch" href="/assets/js/4.7d5f245c.js"><link rel="prefetch" href="/assets/js/5.f8be39f3.js"><link rel="prefetch" href="/assets/js/6.0ba3b038.js"><link rel="prefetch" href="/assets/js/7.38e656bc.js"><link rel="prefetch" href="/assets/js/8.830cb397.js"><link rel="prefetch" href="/assets/js/9.2fac5c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/imgs/logo.png" alt="Range's Documents." class="logo"> <span class="site-name can-hide">Range's Documents.</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Documents
</a></div><div class="nav-item"><a href="https://github.com/Range0122" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Documents
</a></div><div class="nav-item"><a href="https://github.com/Range0122" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/os/" class="sidebar-link">Operating System</a></li><li><a href="/network/" class="sidebar-link">Computer Network</a></li><li><a href="/leetcode/" class="sidebar-link">LeetCode</a></li><li><a href="/browser/" class="sidebar-link">Browser</a></li><li><a href="/html/" class="sidebar-link">HTML</a></li><li><a href="/css/" class="sidebar-link">CSS</a></li><li><a href="/javascript/" class="sidebar-link">JavaScript</a></li><li><a href="/interviews/" class="sidebar-link">Interviews</a></li><li><a href="/project/" class="sidebar-link">Project</a></li><li><a href="/vue/" class="sidebar-link">Vue</a></li><li><a href="/typescript/" class="sidebar-link">TypeScript</a></li><li><a href="/database/" class="sidebar-link">Database</a></li><li><a href="/unorganized/" class="sidebar-link">Unorganized</a></li><li><a href="/life/" class="sidebar-link">Life</a></li><li><a href="/neuroscience/" class="sidebar-link">Neuroscience</a></li><li><a href="/webpack/" aria-current="page" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#_1-解决的问题" class="sidebar-link">1. 解决的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#_1-1-模块化演进过程中出现的问题" class="sidebar-link">1.1 模块化演进过程中出现的问题</a></li><li class="sidebar-sub-header"><a href="/webpack/#_1-2-webpack解决的问题" class="sidebar-link">1.2 Webpack解决的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/#_2-打包的过程" class="sidebar-link">2. 打包的过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#_2-1-安装" class="sidebar-link">2.1 安装</a></li><li class="sidebar-sub-header"><a href="/webpack/#_2-2-简单的打包" class="sidebar-link">2.2 简单的打包</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/#_3-loader" class="sidebar-link">3. Loader</a></li><li class="sidebar-sub-header"><a href="/webpack/#_3-plugin" class="sidebar-link">3. Plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#_3-1-基本使用" class="sidebar-link">3.1 基本使用</a></li><li class="sidebar-sub-header"><a href="/webpack/#_3-2-自己编写插件" class="sidebar-link">3.2 自己编写插件</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/#_4-webpack工作过程" class="sidebar-link">4. Webpack工作过程</a></li><li class="sidebar-sub-header"><a href="/webpack/#_5-webpack-dev-server" class="sidebar-link">5. Webpack-dev-server</a></li><li class="sidebar-sub-header"><a href="/webpack/#_6-sourcemap" class="sidebar-link">6. SourceMap</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#_6-1-简单介绍" class="sidebar-link">6.1 简单介绍</a></li><li class="sidebar-sub-header"><a href="/webpack/#_6-2-webpack中的sourcemap" class="sidebar-link">6.2 Webpack中的SourceMap</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/#_7-模块热替换（hot-module-replacement，hrm）" class="sidebar-link">7. 模块热替换（Hot Module Replacement，HRM）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack/#_7-1-基本概念" class="sidebar-link">7.1 基本概念</a></li><li class="sidebar-sub-header"><a href="/webpack/#_7-2-使用方法" class="sidebar-link">7.2 使用方法</a></li><li class="sidebar-sub-header"><a href="/webpack/#_7-3-hotonly" class="sidebar-link">7.3 HotOnly</a></li></ul></li><li class="sidebar-sub-header"><a href="/webpack/#_8-tree-shaking" class="sidebar-link">8. Tree Shaking</a></li><li class="sidebar-sub-header"><a href="/webpack/#_9-sideeffects" class="sidebar-link">9. sideEffects</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <h2 id="_1-解决的问题"><a href="#_1-解决的问题" class="header-anchor">#</a> 1. 解决的问题</h2> <h3 id="_1-1-模块化演进过程中出现的问题"><a href="#_1-1-模块化演进过程中出现的问题" class="header-anchor">#</a> 1.1 模块化演进过程中出现的问题</h3> <ul><li>模块直接在全局工作，大量模块成员污染全局作用域；</li> <li>没有私有空间，所有模块内的成员都可以在模块外部被访问或者修改；</li> <li>一旦模块增多，容易产生命名冲突；</li> <li>无法管理模块与模块之间的依赖关系；</li> <li>在维护的过程中也很难分辨每个成员所属的模块。</li></ul> <h3 id="_1-2-webpack解决的问题"><a href="#_1-2-webpack解决的问题" class="header-anchor">#</a> 1.2 Webpack解决的问题</h3> <ul><li>能够将散落的模块打包到一起；</li> <li>能够编译代码中的新特性；</li> <li>能够支持不同种类的前端资源模块。</li></ul> <h2 id="_2-打包的过程"><a href="#_2-打包的过程" class="header-anchor">#</a> 2. 打包的过程</h2> <h3 id="_2-1-安装"><a href="#_2-1-安装" class="header-anchor">#</a> 2.1 安装</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm init <span class="token operator">--</span>yes
npm i webpack webpack<span class="token operator">-</span>cli <span class="token operator">--</span>save<span class="token operator">-</span>dev

npx webpack <span class="token operator">--</span>version

npx webpack
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">-</span><span class="token constant">D</span><span class="token operator">:</span> <span class="token operator">--</span>save<span class="token operator">-</span>dev，仅在开发环境中使用
<span class="token operator">-</span><span class="token constant">S</span><span class="token operator">:</span> <span class="token operator">--</span>save，生产环境中要用到的
</code></pre></div><h3 id="_2-2-简单的打包"><a href="#_2-2-简单的打包" class="header-anchor">#</a> 2.2 简单的打包</h3> <ul><li>三种打包模式：
<ul><li>production 模式下，启动内置优化插件，自动优化打包结果，打包速度偏慢；</li> <li>development 模式下，自动优化打包速度，添加一些调试过程中的辅助插件；</li> <li>none 模式下，运行最原始的打包，不做任何额外处理。</li></ul></li> <li><code>mode=none</code>然后查看<code>bundle.js</code>文件</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">__unused_webpack_module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...内容</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 立即执行函数</span>

<span class="token comment">// r函数打上“esModule”的标记</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token string">'Module'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">'__esModule'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 保持原本的依赖关系 并且执行</span>
</code></pre></div><h2 id="_3-loader"><a href="#_3-loader" class="header-anchor">#</a> 3. Loader</h2> <ul><li>webpack将所有文件都视为js，如果需要加载其他类型的文件，还需要额外的loader</li> <li>css-loader + style-loader
<ul><li>因为css-loader只是将.css文件中的代码作为字符串push到一个数组当中，但数组并未被使用</li> <li>而style-loader则是将上一步的结果转换为标签，使用于页面</li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 仅使用css-loader打包后的bundle.js（部分）</span>

<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cssWithMappingToString</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> ___CSS_LOADER_EXPORT___ <span class="token operator">=</span> <span class="token function">_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Module</span>
___CSS_LOADER_EXPORT___<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&quot;body {\n  margin: 0;\n  padding: 0;\n  background-color: #f80;\n}\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 使用style-loader后bundle.js中新增的内容（部分）</span>
<span class="token keyword">function</span> <span class="token function">modulesToDom</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">insertStyleElement</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">removeStyleElement</span><span class="token punctuation">(</span><span class="token parameter">style</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">applyToTag</span><span class="token punctuation">(</span><span class="token parameter">style<span class="token punctuation">,</span> index<span class="token punctuation">,</span> remove<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">addStyle</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">updateStyle</span><span class="token punctuation">(</span><span class="token parameter">newObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// webpack.config.js</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/main.css&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 注意这里是从后往前、按照逆序、分别执行loader</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-plugin"><a href="#_3-plugin" class="header-anchor">#</a> 3. Plugin</h2> <h3 id="_3-1-基本使用"><a href="#_3-1-基本使用" class="header-anchor">#</a> 3.1 基本使用</h3> <ul><li>插件机制：增强项目自动化构建方面的能力</li> <li>Loader 只是在模块的加载环节工作，而插件的作用范围几乎可以触及 Webpack 工作的每一个环节</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;clean-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;copy-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/main.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;04 Plugin&quot;</span><span class="token punctuation">,</span>
      meta<span class="token operator">:</span> <span class="token punctuation">{</span>
        viewport<span class="token operator">:</span> <span class="token string">&quot;width=device-width&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;about.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      patterns<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;public&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-2-自己编写插件"><a href="#_3-2-自己编写插件" class="header-anchor">#</a> 3.2 自己编写插件</h3> <ul><li>apply 方法：这个方法会在 Webpack 启动时被调用，它接收一个 compiler 对象参数，这个对象是 Webpack 工作过程中最核心的对象，里面包含了我们此次构建的所有配置信息，我们就是通过这个对象去注册钩子函数。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">RemoveCommentsPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">complier</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;RemoveCommentsPlugin Launch.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    complier<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;RemoveCommentsPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// compilation =&gt; 可以理解为此次打包的上下文</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> name <span class="token keyword">in</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> contents <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">const</span> withoutComments <span class="token operator">=</span> contents<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\/\*\*+\*\//g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
          compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">source</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> withoutComments<span class="token punctuation">,</span>
            <span class="token function-variable function">size</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> withoutComments<span class="token punctuation">.</span>length
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> RemoveCommentsPlugin<span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-webpack工作过程"><a href="#_4-webpack工作过程" class="header-anchor">#</a> 4. Webpack工作过程</h2> <ul><li>Webpack CLI 启动打包流程；
<ul><li>实现的功能：将 CLI 参数和 Webpack 配置文件中的配置整合，得到一个完整的配置对象。</li> <li>大概过程：
<ul><li>通过<code>yargs</code>模块解析 CLI 参数（即输入命令行的参数）</li> <li>然后将其转换为Webpack的配置选项对象</li> <li>接下来开始载入Webpack核心模块，并传入该配置选项对象</li></ul></li></ul></li> <li>载入 Webpack 核心模块，创建<code>Compiler</code>对象；
<ul><li>校验外部传递过来的<code>options</code>参数是否符合要求，然后判断<code>options</code>的类型。在此过程中Webpack支持同时开启多路打包，内部也就会随之创建<code>MultiComiler</code></li> <li><code>plugin.call(compiler, compiler)</code>和<code>plugin.apply(compiler)</code>来注册已经配置的插件</li> <li>钩子（生命周期）中触发，例如<code>compiler.hooks.environment.call()</code>和<code>compiler.hooks.afterEnvironment.call()</code></li></ul></li> <li>使用 Compiler 对象开始编译整个项目；
<ul><li>触发了<code>beforeRun</code>和<code>run</code>两个钩子，然后最关键的是调用了当前对象的<code>compile</code>方法，真正开始编译整个项目</li> <li>compile 方法内部主要就是创建了一个<code>Compilation</code>对象，<code>Compilation</code>字面意思是“合集”，可以理解为一次构建过程中的上下文对象，里面包含了这次构建中全部的资源和信息。</li> <li>紧接着触发了一个叫作<code>make</code>的钩子，进入最核心的<code>make</code>阶段：
<ul><li>该阶段并没有直接调用对象的某个方法，而是利用事件触发机制，按照顺序依次触发先前设计好的各种事件。基于<code>Tapable</code>库实现的。</li> <li>SingleEntryPlugin 中调用了 Compilation 对象的 addEntry 方法，开始解析入口；</li> <li>addEntry 方法中又调用了 _addModuleChain 方法，将入口模块添加到模块依赖列表中；</li> <li>紧接着通过 Compilation 对象的 buildModule 方法进行模块构建；</li> <li>buildModule 方法中执行具体的 Loader，处理特殊资源加载；</li> <li>build 完成过后，通过 acorn 库生成模块代码的 AST 语法树；</li> <li>根据语法树分析这个模块是否还有依赖的模块，如果有则继续循环 build 每个依赖；</li> <li>所有依赖解析完成，build 阶段结束；</li> <li>最后合并生成需要输出的 bundle.js 写入 dist 目录。</li></ul></li></ul></li> <li>后半部分概括起来，就是：
<ul><li>从入口文件开始，解析模块依赖，形成依赖关系树；</li> <li>递归依赖树，将每个模块交给对应的 Loader 处理；</li> <li>合并 Loader 处理完的结果，将打包结果输出到 dist 目录。</li></ul></li></ul> <h2 id="_5-webpack-dev-server"><a href="#_5-webpack-dev-server" class="header-anchor">#</a> 5. Webpack-dev-server</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code># 安装 webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server
$ npm install webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server <span class="token operator">--</span>save<span class="token operator">-</span>dev
# 运行 webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server
$ npx webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server
</code></pre></div><ul><li>Webpack-dev-server并没有将打包结果写入到磁盘中，而是暂时存放在内存中，内部的HTTP Server也是从内存中读取这些文件的。减少很多不必要的磁盘读写操作，提高了整体的构建效率。</li></ul> <h2 id="_6-sourcemap"><a href="#_6-sourcemap" class="header-anchor">#</a> 6. SourceMap</h2> <h3 id="_6-1-简单介绍"><a href="#_6-1-简单介绍" class="header-anchor">#</a> 6.1 简单介绍</h3> <ul><li>一个<code>.map</code>的JSON格式文件，记录的是转换后和转换前的代码之间的映射关系</li> <li>主要的属性：
<ul><li>version：指定所使用的 Source Map 标准版本；</li> <li>sources：记录的是转换前的源文件名称，因为有可能出现多个文件打包转换为一个文件的情况，所以这里是一个数组；</li> <li>names：源代码中使用的一些成员名称，我们都知道一般压缩代码时会将我们开发阶段编写的有意义的变量名替换为一些简短的字符，这个属性中记录的就是原始的名称；</li> <li>mappings：这个属性最为关键，它是一个叫作 base64-VLQ 编码的字符串，里面记录的信息就是转换后代码中的字符与转换前代码中的字符之间的映射关系。</li></ul></li> <li>Chrome浏览器中的开发人员工具中，Source中看到的文件就是通过这个方法/文件，逆向解析出来的源代码，因而便于定位错误发生在源码中的具体位置。</li></ul> <h3 id="_6-2-webpack中的sourcemap"><a href="#_6-2-webpack中的sourcemap" class="header-anchor">#</a> 6.2 Webpack中的SourceMap</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./webpack.config.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devtool<span class="token operator">:</span> <span class="token string">'source-map'</span> <span class="token comment">// source map 设置</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>devtool</code>字段对应的模式还有很多种，详情参见<a href="https://webpack.js.org/configuration/devtool/#devtool" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或者<a href="https://webpack.docschina.org/configuration/devtool/" target="_blank" rel="noopener noreferrer">中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>名字中带有 module 的模式，解析出来的源代码是没有经过 Loader 加工的，而名字中不带 module 的模式，解析出来的源代码是经过 Loader 加工后的结果。</li> <li>名字中带有 cheap 的模式，一般是阉割版，只定位行，不定位列</li> <li>名字中带有 eval 的模式，一般是用<code>eval</code>来执行代码，通过<code>sourceURL</code>来定位</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// eval 举例</span>

<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;console.log('foo')&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// foo       VM54:1</span>
<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;console.log('foo') //# sourceURL=./foo/bar.js&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// foo       ./foo/bar.js:1</span>

# 虽然现在可能因为eval的安全隐患，不能在浏览器的<span class="token constant">F12</span><span class="token operator">-</span>console中运行上述代码了
</code></pre></div><h2 id="_7-模块热替换（hot-module-replacement，hrm）"><a href="#_7-模块热替换（hot-module-replacement，hrm）" class="header-anchor">#</a> 7. 模块热替换（Hot Module Replacement，HRM）</h2> <h3 id="_7-1-基本概念"><a href="#_7-1-基本概念" class="header-anchor">#</a> 7.1 基本概念</h3> <ul><li>在应用运行过程中，实时的去替换掉应用中的某个模块，而应用的运行状态不会因此而改变，eg.编辑器中的内容，在页面因功能代码改变而刷新后仍然保留。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./webpack.config.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启 HMR 特性，如果资源不支持 HMR 会 fallback 到 live reloading</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token comment">// 只使用 HMR，不会 fallback 到 live reloading</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// HMR 特性所需要的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>但是仅凭以上代码，只能实现「样式文件/CSS」的热更新，但「JS文件」不行</strong>。原因：
<ul><li>HMR 并不像 Webpack 的其他特性一样可以开箱即用，需要有一些额外的操作。</li> <li>样式文件是经过 Loader 处理的，在 style-loader 中就已经自动处理了样式文件的热更新。</li> <li>CSS可以将新模块直接替换旧的，但是JS花样繁多，并没有通用的替换方法。</li> <li>当然，Vue、React脚手架搭建的项目，貌似是可以实现JS热替换的，框架内部本身就实现了替换操作。</li></ul></li></ul> <h3 id="_7-2-使用方法"><a href="#_7-2-使用方法" class="header-anchor">#</a> 7.2 使用方法</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./src/main.js</span>
<span class="token keyword">import</span> createEditor <span class="token keyword">from</span> <span class="token string">'./editor'</span>
<span class="token keyword">import</span> logo <span class="token keyword">from</span> <span class="token string">'./icon.png'</span>
<span class="token keyword">import</span> <span class="token string">'./global.css'</span>

<span class="token keyword">const</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> logo
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>

<span class="token keyword">const</span> editor <span class="token operator">=</span> <span class="token function">createEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>editor<span class="token punctuation">)</span>

<span class="token comment">// HMR --------------------------------</span>
<span class="token comment">// 两个参数，模块的路径，以及该模块更新后调用的函数</span>
<span class="token keyword">let</span> lastEditor <span class="token operator">=</span> editor
module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./editor'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当 editor.js 更新，自动执行此函数</span>
  <span class="token comment">// 临时记录更新前编辑器内容</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> lastEditor<span class="token punctuation">.</span>innerHTML
  <span class="token comment">// 移除更新前的元素</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>lastEditor<span class="token punctuation">)</span>
  <span class="token comment">// 创建新的编辑器</span>
  <span class="token comment">// 此时 createEditor 已经是更新过后的函数了</span>
  lastEditor <span class="token operator">=</span> <span class="token function">createEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 还原编辑器内容</span>
  lastEditor<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> value
  <span class="token comment">// 追加到页面</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>lastEditor<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_7-3-hotonly"><a href="#_7-3-hotonly" class="header-anchor">#</a> 7.3 HotOnly</h3> <ul><li>如果处理热替换的代码（处理函数）中有错误，结果也会导致自动刷新，例子如下：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./src/main.js</span>
<span class="token comment">// ... 其他代码</span>
module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./editor'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 刻意造成运行异常</span>
  <span class="token keyword">undefined</span><span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>因为 HMR 过程报错导致 HMR 失败，HMR 失败过后，会自动回退到自动刷新，页面一旦自动刷新，控制台中的错误信息就会被清除，</li> <li>通过 hotOnly 的方式来解决，如果热替换失败不会使用自动刷新。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./webpack.config.js</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只使用 HMR，不会 fallback 到 live reloading</span>
    hotOnly<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// HMR 特性所需要的插件</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_8-tree-shaking"><a href="#_8-tree-shaking" class="header-anchor">#</a> 8. Tree Shaking</h2> <ul><li>最早是Rollup提出，检测代码中未引用代码（dead-code），然后自动移除它们。</li> <li>Tree-shaking 并不是指 Webpack 中的某一个配置选项，而是一组功能搭配使用过后实现的效果，这组功能在生产模式下都会自动启用，所以使用生产模式打包就会有 Tree-shaking 的效果。</li> <li>涉及的优化功能：
<ul><li><code>usedExports</code> - 打包结果中只导出外部用到的成员；</li> <li><code>minimize</code> - 压缩打包结果。</li></ul></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 其他配置项</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 模块只导出被使用的成员</span>
    usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 尽可能合并每一个模块到一个函数中</span>
    concatenateModules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 压缩输出结果</span>
    minimize<span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_9-sideeffects"><a href="#_9-sideeffects" class="header-anchor">#</a> 9. sideEffects</h2> <ul><li>实现的功能：允许用户通过配置标识我们的代码是否有副作用，从而提供更大的压缩空间。</li> <li>模块的副作用：指的就是模块执行的时候除了导出成员，是否还做了其他的事情。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/neuroscience/" class="prev">
        Neuroscience
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.76b04930.js" defer></script><script src="/assets/js/2.f4607b1e.js" defer></script><script src="/assets/js/22.dddc26a9.js" defer></script>
  </body>
</html>
