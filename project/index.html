<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Project | Range&#39;s Documents.</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Meet more than the eyes.">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.76b04930.js" as="script"><link rel="preload" href="/assets/js/2.f4607b1e.js" as="script"><link rel="preload" href="/assets/js/18.cb942bd1.js" as="script"><link rel="prefetch" href="/assets/js/10.f1a63439.js"><link rel="prefetch" href="/assets/js/11.ee698251.js"><link rel="prefetch" href="/assets/js/12.cb6c9e06.js"><link rel="prefetch" href="/assets/js/13.70cff9bc.js"><link rel="prefetch" href="/assets/js/14.4a79e630.js"><link rel="prefetch" href="/assets/js/15.67d11263.js"><link rel="prefetch" href="/assets/js/16.72f4a548.js"><link rel="prefetch" href="/assets/js/17.0268da32.js"><link rel="prefetch" href="/assets/js/19.1c1462cc.js"><link rel="prefetch" href="/assets/js/20.633a6928.js"><link rel="prefetch" href="/assets/js/21.0ed654e1.js"><link rel="prefetch" href="/assets/js/22.dddc26a9.js"><link rel="prefetch" href="/assets/js/3.aa48cf35.js"><link rel="prefetch" href="/assets/js/4.7d5f245c.js"><link rel="prefetch" href="/assets/js/5.f8be39f3.js"><link rel="prefetch" href="/assets/js/6.0ba3b038.js"><link rel="prefetch" href="/assets/js/7.38e656bc.js"><link rel="prefetch" href="/assets/js/8.830cb397.js"><link rel="prefetch" href="/assets/js/9.2fac5c3a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/imgs/logo.png" alt="Range's Documents." class="logo"> <span class="site-name can-hide">Range's Documents.</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Documents
</a></div><div class="nav-item"><a href="https://github.com/Range0122" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  Documents
</a></div><div class="nav-item"><a href="https://github.com/Range0122" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/os/" class="sidebar-link">Operating System</a></li><li><a href="/network/" class="sidebar-link">Computer Network</a></li><li><a href="/leetcode/" class="sidebar-link">LeetCode</a></li><li><a href="/browser/" class="sidebar-link">Browser</a></li><li><a href="/html/" class="sidebar-link">HTML</a></li><li><a href="/css/" class="sidebar-link">CSS</a></li><li><a href="/javascript/" class="sidebar-link">JavaScript</a></li><li><a href="/interviews/" class="sidebar-link">Interviews</a></li><li><a href="/project/" aria-current="page" class="active sidebar-link">Project</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_1-项目概览" class="sidebar-link">1. 项目概览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_1-1-组件架构" class="sidebar-link">1.1 组件架构</a></li><li class="sidebar-sub-header"><a href="/project/#_1-2-组件逻辑" class="sidebar-link">1.2 组件逻辑</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_2-项目细节" class="sidebar-link">2. 项目细节</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_2-1-我负责部分" class="sidebar-link">2.1 我负责部分</a></li><li class="sidebar-sub-header"><a href="/project/#_2-2-一些小的亮点" class="sidebar-link">2.2 一些小的亮点</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_3-难点与解决方案" class="sidebar-link">3. 难点与解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_3-1-css的布局与居中问题" class="sidebar-link">3.1 CSS的布局与居中问题</a></li><li class="sidebar-sub-header"><a href="/project/#_3-2-前后端分离的业务逻辑问题" class="sidebar-link">3.2 前后端分离的业务逻辑问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_4-typescript重构" class="sidebar-link">4. TypeScript重构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_4-1-概览" class="sidebar-link">4.1 概览</a></li><li class="sidebar-sub-header"><a href="/project/#_4-2-难点" class="sidebar-link">4.2 难点</a></li><li class="sidebar-sub-header"><a href="/project/#_4-3-对于typescript的理解" class="sidebar-link">4.3 对于TypeScript的理解</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_5-测试" class="sidebar-link">5. 测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_5-1-灰盒测试" class="sidebar-link">5.1 灰盒测试</a></li><li class="sidebar-sub-header"><a href="/project/#_5-2-性能测试" class="sidebar-link">5.2 性能测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_6-优化" class="sidebar-link">6. 优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_6-1-性能优化" class="sidebar-link">6.1 性能优化</a></li><li class="sidebar-sub-header"><a href="/project/#_6-2-用户友好性" class="sidebar-link">6.2 用户友好性</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_7-还可以改进的地方" class="sidebar-link">7. 还可以改进的地方</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_7-1-用户友好性" class="sidebar-link">7.1 用户友好性</a></li><li class="sidebar-sub-header"><a href="/project/#_7-2-文档" class="sidebar-link">7.2 文档</a></li><li class="sidebar-sub-header"><a href="/project/#_7-4-安全" class="sidebar-link">7.4 安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/project/#_8-插件" class="sidebar-link">8. 插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/project/#_8-1-betterscroll" class="sidebar-link">8.1 BetterScroll</a></li><li class="sidebar-sub-header"><a href="/project/#_8-2-fastclick" class="sidebar-link">8.2 FastClick</a></li></ul></li></ul></li><li><a href="/vue/" class="sidebar-link">Vue</a></li><li><a href="/typescript/" class="sidebar-link">TypeScript</a></li><li><a href="/database/" class="sidebar-link">Database</a></li><li><a href="/unorganized/" class="sidebar-link">Unorganized</a></li><li><a href="/life/" class="sidebar-link">Life</a></li><li><a href="/neuroscience/" class="sidebar-link">Neuroscience</a></li><li><a href="/webpack/" class="sidebar-link">Webpack</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="project"><a href="#project" class="header-anchor">#</a> Project</h1> <h2 id="_1-项目概览"><a href="#_1-项目概览" class="header-anchor">#</a> 1. 项目概览</h2> <h3 id="_1-1-组件架构"><a href="#_1-1-组件架构" class="header-anchor">#</a> 1.1 组件架构</h3> <p><img src="/imgs/comp_cons.png" alt="image"></p> <h3 id="_1-2-组件逻辑"><a href="#_1-2-组件逻辑" class="header-anchor">#</a> 1.2 组件逻辑</h3> <p><img src="/imgs/comp_logic.png" alt="image"></p> <h2 id="_2-项目细节"><a href="#_2-项目细节" class="header-anchor">#</a> 2. 项目细节</h2> <h3 id="_2-1-我负责部分"><a href="#_2-1-我负责部分" class="header-anchor">#</a> 2.1 我负责部分</h3> <ul><li>主页面的三个模块：车次、我的车票、个人中心
<ul><li>车次</li> <li>我的车票：这里又有一个子路由，四个页面之间跳转</li> <li>个人中心</li> <li>以及网络请求模块</li></ul></li></ul> <h3 id="_2-2-一些小的亮点"><a href="#_2-2-一些小的亮点" class="header-anchor">#</a> 2.2 一些小的亮点</h3> <ul><li><p>路由懒加载：增加首屏的加载速度</p> <ul><li>将app.js拆分，多出几个js文件，也就是其他路由页面的js文件</li></ul></li> <li><p>Vuex来管理 bus 的座位信息和 user 的 localStorage 中的 token</p></li> <li><p>vh来实现了响应式的布局</p></li> <li><p>导航守卫：（router.beforeEach）</p> <ul><li>来保证每次切换页面之前，都要检查是否已经登陆</li> <li>如果是从「确认订单」的页面跳转回「车次信息」（选座位的页面），还要恢复之前已经选中的座位的被选中的状态</li></ul></li> <li><p>封装、复用的思想：</p> <ul><li>比如 getOrder 这个获取订单的函数的复用，只需要根据参数不同，来获取不同的订单，不需要再写多个函数了。</li> <li>订单详情页面的复用，已支付 / 未支付的订单用同一个组件，只是根据状态，下面是候车时间 / 前往支付</li></ul></li> <li><p>跨域</p> <ul><li>vue的devServer.proxy</li> <li>本身应该是来自于一个叫做 <code>http-proxy-middleware</code>的集成</li> <li>参数中，开启了WebSocket，并且changeOrigin。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vue.config.js</span>
devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
  proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'/apis'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">'http://sb.dreamcat.ink:2020/'</span><span class="token punctuation">,</span>
        ws<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token string">'^/apis'</span><span class="token operator">:</span> <span class="token string">''</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="_3-难点与解决方案"><a href="#_3-难点与解决方案" class="header-anchor">#</a> 3. 难点与解决方案</h2> <h3 id="_3-1-css的布局与居中问题"><a href="#_3-1-css的布局与居中问题" class="header-anchor">#</a> 3.1 CSS的布局与居中问题</h3> <ul><li>作为前端的新手，经常分不清 vertical-middle / text-align 之类的是什么作用</li> <li>百分比完全分不清楚是根据谁的百分比</li> <li>经常会写了样式，发现为什么不生效呢，或者生效了也不知道为什么</li></ul> <h3 id="_3-2-前后端分离的业务逻辑问题"><a href="#_3-2-前后端分离的业务逻辑问题" class="header-anchor">#</a> 3.2 前后端分离的业务逻辑问题</h3> <ul><li>一个任务，到底是前端做呢，还是交给后端做呢？</li> <li>尽可能地分担后端的压力，并且减少网络上的流量：
<ul><li>这个思想跟缓存很接近（感叹，很多东西本质上都是想通的）</li> <li>但是也不能什么都前端实现，客户端臃肿，发送的流量大，违背了初衷</li> <li>比如：
<ul><li>注册时候的确认密码判断：没必要发给客户端，或者检查注册信息中是否有不合法的字符</li> <li>登陆的时候要显示账号或密码错误，而不是很直白的账号不存在或者密码错误，数据库里面是用哈希算法存的摘要，做摘要这个几乎是不可逆的计算，所以一般网络上见到的只有重置密码，没有找回原密码。</li></ul></li></ul></li></ul> <h2 id="_4-typescript重构"><a href="#_4-typescript重构" class="header-anchor">#</a> 4. TypeScript重构</h2> <h3 id="_4-1-概览"><a href="#_4-1-概览" class="header-anchor">#</a> 4.1 概览</h3> <ul><li>主要的页面已经基本能跑起来</li></ul> <h3 id="_4-2-难点"><a href="#_4-2-难点" class="header-anchor">#</a> 4.2 难点</h3> <h4 id="_4-2-1-ref的问题"><a href="#_4-2-1-ref的问题" class="header-anchor">#</a> 4.2.1 ref的问题</h4> <ul><li><p>主要还是vue2.x对于ts的支持不是很好，比如用的比较多的vue-property-decorator是vue社区出品。（所以期待vue3.0的ts）</p></li> <li><p>scroll绑定了ref属性，方便调用，但是typescript里面不支持直接获取ref属性，需要单独声明一个属性去调用它</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 1. 声明一个属性</span>
<span class="token keyword">class</span> <span class="token class-name">YourComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  $refs<span class="token operator">:</span> <span class="token punctuation">{</span>
    checkboxElement<span class="token operator">:</span> HTMLFormElement
  <span class="token punctuation">}</span>

  <span class="token function">someMethod</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>checkboxElement<span class="token punctuation">.</span>checked
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 声明计算属性</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Vue<span class="token punctuation">,</span> Component<span class="token punctuation">,</span> Ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-property-decorator'</span>

<span class="token keyword">import</span> AnotherComponent <span class="token keyword">from</span> <span class="token string">'@/path/to/another-component.vue'</span>

@Component
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">YourComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>
  @<span class="token function">Ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">readonly</span> anotherComponent<span class="token operator">!</span><span class="token operator">:</span> AnotherComponent
  @<span class="token function">Ref</span><span class="token punctuation">(</span><span class="token string">'aButton'</span><span class="token punctuation">)</span> <span class="token keyword">readonly</span> button<span class="token operator">!</span><span class="token operator">:</span> HTMLButtonElement
<span class="token punctuation">}</span>

<span class="token comment">// 3. 使用vuevue-property-decorator提供的Ref属性</span>
 <span class="token keyword">get</span> <span class="token function">refs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">any</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clildGreet<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>StackOverflow是真的靠谱！</p></li></ul> <h4 id="_4-2-2-项目比较庞大不知道怎么入手"><a href="#_4-2-2-项目比较庞大不知道怎么入手" class="header-anchor">#</a> 4.2.2 项目比较庞大不知道怎么入手</h4> <ul><li>很低效的方式是对比法：跟别人的项目比较，看自己缺了什么配置，就补充什么配置，但其实项目不同，配置依赖等都不同</li> <li>比较一目了然的方法是：跟着别人写的经验、或者官方文档去初始化一个新的项目：
<ul><li>一方面，可以了解TypeScript和Vue在初始化的时候是怎么结合起来的，便于理解和记忆怎么去配置，使二者合作</li> <li>另一方面，保证项目中不会缺失一些配置，或者可以根据自己的需要去配置一些东西，而不是跟着别人的项目走，并且看到一大堆的配置文件还是云里雾里的。</li></ul></li> <li>因为是强类型，有时候确实是不确定一个数据的类型的时候，只能用any，但是总是用any的话，感觉就失去了使用typeScript的意义。为什么叫<strong>type</strong>script，重点在 type</li> <li>过程中我也学到了很多东西：
<ul><li>入口很重要，就有点像之前跟着网上的一个教程简单实现一个vue（这里要好好去看下vue的基本原理和那份代码）</li> <li>将大的模块拆分成小的，这里也体现了封装、模块化、强内聚低耦合的优越性，最重要的是写注释极大提高了代码的可读性，便于维护。</li> <li>先重构路由相关的几个主要展示的组件，然后再对于每个组件下的子组件及其相关的部分进行重构，包括网络请求和Vuex状态管理</li></ul></li></ul> <h3 id="_4-3-对于typescript的理解"><a href="#_4-3-对于typescript的理解" class="header-anchor">#</a> 4.3 对于TypeScript的理解</h3> <ul><li>强类型语言，但仅仅是编程时候，或者说是提供了一种js下强类型的编程范式，但是也可以不遵守</li> <li>因为最终ts的代码是被转化为es5的js代码，然后被浏览器执行的，所以非要说的话，其实本质上并没有发生改变</li> <li>即使IDE/tsLint可以检查出ts中的语法错误，但仍然是可以执行的，这些都是由于TS基于JS，而JS的本质是弱类型语言以及JS的一些其他的特定，决定了运行时的一些效果。</li> <li>重构代码的过程中，但是避免了在类型上出错，同时这种面向对象的编程思想，也增强了代码的可读性，对于大型项目而言降低了维护成本，虽然重构的时候ESLint搞得人很痛苦，并且至于性能还有待测试。</li> <li>目前在第三方组件vant的引入上还是有点问题，组件引入了但是显示的其中嵌入的内容不正确。</li></ul> <h2 id="_5-测试"><a href="#_5-测试" class="header-anchor">#</a> 5. 测试</h2> <h3 id="_5-1-灰盒测试"><a href="#_5-1-灰盒测试" class="header-anchor">#</a> 5.1 灰盒测试</h3> <h4 id="_5-1-1-概念"><a href="#_5-1-1-概念" class="header-anchor">#</a> 5.1.1 概念</h4> <ul><li>Jest：一个JavaScript测试框架（或者说，一款比较主流的 JavaScript 测试运行器），支持Vue，提供简单易用的api，支持生成代码覆盖率报告
<ul><li>匹配器：toBe、toBeCloseTo、toEqual、toBeNull等</li> <li>钩子函数：beforeAll、afterAll、beforeEach、afterEach</li> <li>同步测试/异步测试</li> <li>shallowMount/mount：
<ul><li>mount：计算机中指 挂载</li> <li>shallowMount：渲染的子组件是假的，只mount了当前组件（可能单元测试应该用这个）</li> <li>mount：完整的渲染（可能适合集成测试的时候使用）</li></ul></li></ul></li> <li>vue-test-util：Vue Test Utils 是Vue.js 官方的单元测试实用工具库</li> <li>babel：Jest不支持ES6语法，需要用babel转化一下</li></ul> <h4 id="_5-1-2-测试内容"><a href="#_5-1-2-测试内容" class="header-anchor">#</a> 5.1.2 测试内容</h4> <ul><li><p>主要测试了<strong>登陆模块</strong></p></li> <li><p>同步测试</p> <ul><li><p>主要是测试了一些组件生成之后内容是否对应</p></li> <li><p>因为组件本身比较简单，所以就相当于操作了一些怎么写测试。</p></li> <li><p>示例代码</p></li> <li><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./src/components/hello-world/hello-world.spec.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> tabBar <span class="token keyword">from</span> <span class="token string">'./tabBar'</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'&lt;tab-bar/&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>tabBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should render correct contents'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>异步测试</p> <ul><li><p>mock掉原有的网络请求模块：比如<code>jest.mock('../../apis/user');</code></p></li> <li><p>然后 shallowMount 现有的组件，调用mock下的原本的网络请求函数</p></li> <li><p>返回预设好的值，判断是否通过用例</p></li> <li><p>示例代码：</p></li> <li><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./src/components/user-info/user-info.spec.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> shallowMount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> UserInfo <span class="token keyword">from</span> <span class="token string">'./user-info'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> UserApi <span class="token keyword">from</span> <span class="token string">'../../apis/user'</span><span class="token punctuation">;</span>

<span class="token comment">// mock 掉 user 模块</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'../../apis/user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 指定 getUserInfo 方法返回假数据</span>
UserApi<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'olive'</span><span class="token punctuation">,</span>
  desc<span class="token operator">:</span> <span class="token string">'software engineer'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'&lt;user-info/&gt;'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>UserInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'getUserInfo 有且只 call 了一次'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>UserApi<span class="token punctuation">.</span>getUserInfo<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'用户信息渲染正确'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'olive'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.desc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">'software engineer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>快照测试</p> <ul><li><p>SnapShot</p></li> <li><p>第一次运行快照测试时会生成一个快照文件。</p></li> <li><p>之后每次执行测试的时候，会生成一个快照，然后对比最初生成的快照文件:</p> <ul><li>如果没有发生改变，则通过测试。</li> <li>否则测试不通过，同时会输出结果，对比不匹配的地方。</li></ul></li> <li><div class="language-javascript extra-class"><pre class="language-javascript"><code>Test Suites<span class="token operator">:</span> <span class="token number">1</span> passed<span class="token punctuation">,</span> <span class="token number">1</span> total
Tests<span class="token operator">:</span>       <span class="token number">2</span> passed<span class="token punctuation">,</span> <span class="token number">2</span> total
Snapshots<span class="token operator">:</span>   <span class="token number">2</span> passed<span class="token punctuation">,</span> <span class="token number">2</span> total
Time<span class="token operator">:</span>        <span class="token number">1</span>s
Ran all test suites<span class="token punctuation">.</span>
Done <span class="token keyword">in</span> <span class="token number">1.02</span>s<span class="token punctuation">.</span>
</code></pre></div></li></ul></li></ul> <h4 id="_5-1-3-遇到的困难"><a href="#_5-1-3-遇到的困难" class="header-anchor">#</a> 5.1.3 遇到的困难</h4> <ul><li>主要还是因为项目比较小，不能够很好地体现使用工具进行自动化测试的优秀之处。</li> <li>当然，实践之后总还是有一些体会：一旦项目比较大了，就没办法只是通过人工测试、或者手工输入一个一个的用例</li></ul> <h4 id="_5-1-3-代码覆盖率"><a href="#_5-1-3-代码覆盖率" class="header-anchor">#</a> 5.1.3 代码覆盖率</h4> <ul><li>概念：简单来说，就是 被测试执行的代码的数量 / 代码总数量</li> <li>对于覆盖率的思考：
<ul><li>是一个辩证看待的指标：
<ul><li>代码覆盖并不等于测试质量、代码质量，甚至有可能测试用例本身就是错误的</li> <li>但是反过来，覆盖率低，代码质量可能就不一定会很好。</li></ul></li> <li>不必强求100%覆盖率：
<ul><li>有个边际效用递减问题，为了追求数字上的完美，你可能要付出过多的代价，得不偿失，还不如省下点力气花在其它地方。</li> <li>达到固然可嘉，但是随着项目的增大，达到100%覆盖的代价很大，有时候项目需要尽快上线盈利，可能就没有足够的时间测试所有的模块，只能先测试最核心、最重要的部分。（主要的业务功能要能够正常执行）</li></ul></li> <li>当然这里只是很笼统地说覆盖，详细的也分为：语句覆盖、判定覆盖、条件覆盖、路径覆盖</li></ul></li></ul> <h4 id="_5-1-4-个人的思考"><a href="#_5-1-4-个人的思考" class="header-anchor">#</a> 5.1.4 个人的思考</h4> <ul><li>前言：其实最开始是打算做性能测试的，结果学习到后面这个测试工具，更像是专门用来做单元测试、集成测试的，主要是来测试功能而不是性能。</li> <li>很像是灰盒测试，其<strong>核心是通关断言的方式</strong>来测试输入输出是否正确匹配，即是否完成了指定的功能。同时，生成的覆盖率报告又涉及到了白盒测试的思想，它会检查有哪些分支覆盖了。</li> <li>为什么要做测试？因为现学前端，短期内不光要掌握前端各方面的基础知识，同时如果还需要脱颖而出，就需要一些亮点，而我的想法是做一些折腾的事情、剑走偏锋，当然毕竟是现学，基础薄弱的这个弱点还是没办法掩盖的，但是我还是比较希望尽可能从这个项目中展现我的能力和思路。</li></ul> <h3 id="_5-2-性能测试"><a href="#_5-2-性能测试" class="header-anchor">#</a> 5.2 性能测试</h3> <h2 id="_6-优化"><a href="#_6-优化" class="header-anchor">#</a> 6. 优化</h2> <ul><li><strong>其实最大的问题还是做的比较泛，都是浅尝辄止，没有针对哪一个方向深入下去。有自身原因，也有客观原因。</strong></li> <li><strong>或者说，策略是：先将基本的能够优化的部分做了，然后再把某个方向做到极致，就类似于，九门课，先都保证能够考及格，然后再考虑把某一门课加强，甚至是做到考满分。</strong></li></ul> <h3 id="_6-1-性能优化"><a href="#_6-1-性能优化" class="header-anchor">#</a> 6.1 性能优化</h3> <h4 id="_6-1-1-班车项目"><a href="#_6-1-1-班车项目" class="header-anchor">#</a> 6.1.1 班车项目</h4> <table><thead><tr><th style="text-align:center;">优化<br>方法</th> <th style="text-align:center;">打包<br>时间</th> <th style="text-align:center;">打包<br>体积</th> <th style="text-align:center;">DOM-Content-Loaded</th> <th style="text-align:center;">Load</th> <th style="text-align:center;">app.js</th> <th style="text-align:center;">chunk-vendors.js</th> <th style="text-align:center;">初始<br>页面</th> <th style="text-align:center;">登陆<br>下单</th></tr></thead> <tbody><tr><td style="text-align:center;">全优化</td> <td style="text-align:center;">6.83s</td> <td style="text-align:center;"><strong>928kB</strong></td> <td style="text-align:center;">0.97s</td> <td style="text-align:center;">1.33s</td> <td style="text-align:center;">305kB</td> <td style="text-align:center;">1.4MB</td> <td style="text-align:center;">2.5MB</td> <td style="text-align:center;"><strong>4.2MB</strong></td></tr> <tr><td style="text-align:center;">无优化</td> <td style="text-align:center;">7.54s</td> <td style="text-align:center;">2.8MB</td> <td style="text-align:center;">1.02s</td> <td style="text-align:center;">1.45s</td> <td style="text-align:center;">306kB</td> <td style="text-align:center;">2.6MB</td> <td style="text-align:center;">3.6MB</td> <td style="text-align:center;">5.3MB</td></tr> <tr><td style="text-align:center;">代码丑化</td> <td style="text-align:center;">9.94s</td> <td style="text-align:center;"><strong>1.0MB</strong></td> <td style="text-align:center;">0.97s</td> <td style="text-align:center;">1.32s</td> <td style="text-align:center;">396kB</td> <td style="text-align:center;">2.5MB</td> <td style="text-align:center;">3.5MB</td> <td style="text-align:center;">5.1MB</td></tr> <tr><td style="text-align:center;">cdn</td> <td style="text-align:center;"><strong>5.07s</strong></td> <td style="text-align:center;">2.1MB</td> <td style="text-align:center;">1.08s</td> <td style="text-align:center;">1.34s</td> <td style="text-align:center;">306kB</td> <td style="text-align:center;">1.4MB</td> <td style="text-align:center;">2.5MB</td> <td style="text-align:center;">4.3MB</td></tr> <tr><td style="text-align:center;"><strong>无</strong>路由懒加载</td> <td style="text-align:center;">8.99s</td> <td style="text-align:center;">2.4MB</td> <td style="text-align:center;"><strong>1.67s</strong></td> <td style="text-align:center;"><strong>2.01s</strong></td> <td style="text-align:center;"><strong>1.7MB</strong></td> <td style="text-align:center;"><strong>3.4MB</strong></td> <td style="text-align:center;"><strong>5.1MB</strong></td> <td style="text-align:center;">5.1MB</td></tr> <tr><td style="text-align:center;">vant按需引入</td> <td style="text-align:center;">6.23s</td> <td style="text-align:center;">2.8MB</td> <td style="text-align:center;">0.95s</td> <td style="text-align:center;">1.38s</td> <td style="text-align:center;">306kB</td> <td style="text-align:center;">2.5MB</td> <td style="text-align:center;">3.5MB</td> <td style="text-align:center;">5.1MB</td></tr> <tr><td style="text-align:center;">代码优化</td> <td style="text-align:center;">7.48s</td> <td style="text-align:center;">2.8MB</td> <td style="text-align:center;">0.95s</td> <td style="text-align:center;">1.38s</td> <td style="text-align:center;">306kB</td> <td style="text-align:center;">2.5MB</td> <td style="text-align:center;">3.5MB</td> <td style="text-align:center;">5.1MB</td></tr> <tr><td style="text-align:center;">无图片懒加载*</td> <td style="text-align:center;">9.95s</td> <td style="text-align:center;">1.7MB</td> <td style="text-align:center;">0.86s</td> <td style="text-align:center;">2.41s</td> <td style="text-align:center;">246kB</td> <td style="text-align:center;">2.4MB</td> <td style="text-align:center;">6.4MB</td> <td style="text-align:center;">N/A</td></tr> <tr><td style="text-align:center;">图片懒加载*</td> <td style="text-align:center;">9.93s</td> <td style="text-align:center;">1.7MB</td> <td style="text-align:center;">1.05s</td> <td style="text-align:center;">2.04s</td> <td style="text-align:center;">247kB</td> <td style="text-align:center;">2.5MB</td> <td style="text-align:center;">4.6MB</td> <td style="text-align:center;">N/A</td></tr></tbody></table> <ul><li>备注：
<ul><li>代码层面的优化：
<ul><li>冗余的div、无用的空格、换行符、注释。</li> <li>引入但未被使用的组件、变量</li> <li>文件命名规范、语义化</li> <li>代码风格：分号、驼峰变量命名、缩进</li></ul></li> <li>概念：
<ul><li>chunk-venders.js是引用的第三方库的代码</li> <li>app.js是开发者自己写的代码</li></ul></li></ul></li> <li>疑问：
<ul><li>丑化后的dist只有1.0MB，但是初始页面仍然是3.5MB的大小</li> <li>uglify没有完善的程序流分析。它可以简单的判断变量后续是否被引用、修改，但是不能判断一个变量完整的修改过程，不知道它是否已经指向了外部变量，所以很多有可能会产生副作用的代码，都只能保守的不删除。</li></ul></li></ul> <h4 id="_6-1-2-内存泄漏检查"><a href="#_6-1-2-内存泄漏检查" class="header-anchor">#</a> 6.1.2 内存泄漏检查</h4> <ul><li><p>理论上，内存泄漏的原因：</p> <ul><li>未被销毁的DOM事件监听</li> <li>全局变量</li> <li>脱离DOM的引用</li> <li>闭包</li> <li>计时器或者回调函数</li></ul></li> <li><p>时间线测试：</p></li> <li><p>初步测试（5分钟，切换了两次账号）</p></li></ul> <p><img src="/imgs/leak-line1.png" alt="image"></p> <ul><li>再次测试（9分钟，切换了五次账号）</li></ul> <p><img src="/imgs/leak-line2.png" alt="image"></p> <ul><li><p>快照测试</p></li> <li><p>概览</p></li></ul> <p><img src="/imgs/leak1.png" alt="image"></p> <ul><li>看得出来似乎还是有一些内存泄漏的，打开比较模式，并且意外在每个快照对比上一个快照的时候，都产生了新的闭包</li></ul> <p><img src="/imgs/leak2.png" alt="image"></p> <p><img src="/imgs/leak3.png" alt="image"></p> <p><img src="/imgs/leak4.png" alt="image"></p> <p><img src="/imgs/leak5.png" alt="image"></p> <p><img src="/imgs/leak6.png" alt="image"></p> <ul><li>查看闭包之前，先看看这个占用新增的内存的大头array里面都有什么</li></ul> <p><img src="/imgs/leak7.png" alt="image"></p> <p>接着，再来仔细看看闭包的内容</p> <p><img src="/imgs/leak8.png" alt="image"></p> <p><img src="/imgs/leak9.png" alt="image"></p> <p><img src="/imgs/leak10.png" alt="image"></p> <ul><li>关闭比较模式，来看一下快照本身的元素</li></ul> <p><img src="/imgs/leak11.png" alt="image"></p> <h3 id="_6-2-用户友好性"><a href="#_6-2-用户友好性" class="header-anchor">#</a> 6.2 用户友好性</h3> <ul><li>Toast 淡入淡出的效果</li> <li>Loading加载组件</li> <li>骨架图组件</li></ul> <h2 id="_7-还可以改进的地方"><a href="#_7-还可以改进的地方" class="header-anchor">#</a> 7. 还可以改进的地方</h2> <h3 id="_7-1-用户友好性"><a href="#_7-1-用户友好性" class="header-anchor">#</a> 7.1 用户友好性</h3> <ul><li>下拉的时候「加载中」的提示，悬停半秒钟，然后显示加载成功。而不是直接就滑回上面去了。</li> <li>toast的淡入淡出效果</li> <li>及时的反馈：登陆/注册  成功/失败的时候给一个toast提示</li> <li>keep-alive只能保证不重新加载，但是如果一个页面比较长，还需要在 actived / deactivated 的钩子函数里面保存scroll的位置</li></ul> <h3 id="_7-2-文档"><a href="#_7-2-文档" class="header-anchor">#</a> 7.2 文档</h3> <ul><li>开发模式基本上算是瀑布模型</li> <li>印象里这种模型是文档驱动的，需要保证每一步都稳健，防止在后期出现严重的需求错误/设计错误。</li></ul> <h3 id="_7-4-安全"><a href="#_7-4-安全" class="header-anchor">#</a> 7.4 安全</h3> <ul><li>XSS攻击，并没有在提交的时候对于提交的内容进行审查，查看是否包含了字符串形式的脚本文件。</li> <li>CSRF攻击，虽然是服务器，但是没有做 - -</li></ul> <h2 id="_8-插件"><a href="#_8-插件" class="header-anchor">#</a> 8. 插件</h2> <h3 id="_8-1-betterscroll"><a href="#_8-1-betterscroll" class="header-anchor">#</a> 8.1 BetterScroll</h3> <h3 id="_8-2-fastclick"><a href="#_8-2-fastclick" class="header-anchor">#</a> 8.2 FastClick</h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/interviews/" class="prev">
        Interviews
      </a></span> <span class="next"><a href="/vue/">
        Vue
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.76b04930.js" defer></script><script src="/assets/js/2.f4607b1e.js" defer></script><script src="/assets/js/18.cb942bd1.js" defer></script>
  </body>
</html>
